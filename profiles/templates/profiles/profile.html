{% extends "base.html" %}
{% load i18n %}
{% load static %}
{% load crispy_forms_tags %}
{% load crispy_forms_filters %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/profile.css' %}">
{% endblock %}
{% block extra_js %}
  <script src="{% static 'js/profile.js' %}"></script>
{% endblock %}

{% block page_header %}
  <div class="container header-container">
    <div class="row"><div class="col"></div></div>
  </div>
{% endblock %}

{% block content %}
<div class="overlay"></div>

<div class="container">
  <div class="row">
    <div class="col">
      <h2 class="logo-font mb-4 py-5">{% trans "My Profile" %}</h2>
    </div>
  </div>

  <div class="profile-grid">
    <!-- LEFT: stacked settings -->
    <div class="left-stack">

      <!-- Account Settings -->
      <div class="card card-compact shadow-sm">
        <div class="card-header"><strong>{% trans "Account Settings" %}</strong></div>
        <div class="card-body">
          <form action="{% url 'profiles:profile' %}" method="post" id="account-settings-form">
            {% csrf_token %}
            <input type="hidden" name="section" value="account">
            <div class="row g-2 form-row-compact">
              <div class="col-12 col-lg-6">{{ user_form.first_name|as_crispy_field }}</div>
              <div class="col-12 col-lg-6">{{ user_form.last_name|as_crispy_field }}</div>
              <div class="col-12">{{ user_form.email|as_crispy_field }}</div>
            </div>
            <div class="mt-3 d-flex">
              <button type="submit" class="btn btn-black btn-compact rounded-0 text-uppercase ms-auto">
                {% trans "Update Account" %}
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Security -->
      <div class="card card-compact shadow-sm">
        <div class="card-header"><strong>{% trans "Security" %}</strong></div>
        <div class="card-body">
          <p class="mb-2 text-muted small">{% trans "Manage your password and sign-in settings." %}</p>
          <div class="d-grid gap-2">
            <a class="btn btn-outline-dark btn-compact rounded-0 text-uppercase"
               href="{% url 'account_change_password' %}">
              {% trans "Change Password" %}
            </a>
            <a class="btn btn-outline-secondary btn-compact rounded-0 text-uppercase"
               href="{% url 'account_reset_password' %}">
              {% trans "Reset Password" %}
            </a>
            <a class="btn btn-outline-secondary btn-compact rounded-0 text-uppercase"
               href="{% url 'account_email' %}">
              {% trans "Manage Email Addresses" %}
            </a>
          </div>
        </div>
      </div>

      <!-- Address & Delivery -->
      <div class="card card-compact shadow-sm">
        <div class="card-header"><strong>{% trans "Address & Delivery" %}</strong></div>
        <div class="card-body">
          <form action="{% url 'profiles:profile' %}" method="post" id="address-delivery-form">
            {% csrf_token %}
            <input type="hidden" name="section" value="address">
            <fieldset class="mb-1">
              <legend class="h6 mb-2">{% trans "Default Delivery Information" %}</legend>
              <div class="row g-2 form-row-compact">
                <div class="col-12 col-lg-6">{{ form.phone_number|as_crispy_field }}</div>
                <div class="col-12 col-lg-6">{{ form.postcode|as_crispy_field }}</div>
                <div class="col-12 col-lg-6">{{ form.town_or_city|as_crispy_field }}</div>
                <div class="col-12 col-lg-6">{{ form.county|as_crispy_field }}</div>
                <div class="col-12">{{ form.street_address1|as_crispy_field }}</div>
                <div class="col-12">{{ form.street_address2|as_crispy_field }}</div>
                <div class="col-12 col-lg-6">{{ form.country|as_crispy_field }}</div>
              </div>
            </fieldset>
            <div class="mt-3 d-flex">
              <button type="submit" class="btn btn-black btn-compact rounded-0 text-uppercase ms-auto">
                {% trans "Update Address" %}
              </button>
            </div>
          </form>
        </div>
      </div>

    </div>

    <!-- RIGHT: Order history as matching card -->
    <div>
      <div class="card card-compact shadow-sm orders-equal">
        <div class="card-header"><strong>{% trans "Order History" %}</strong></div>
        <div class="card-body text-center">          
          <div class="card-body text-center ">
            <ul class="list-group text-start">
              {% for order in orders %}
                <li class="list-group-item">
                  <a href="{% url 'order_history' order.order_number %}">{{ order.order_number }}</a>
                </li>
              {% empty %}
                <p class="text-muted small mb-0 text-center">{% trans "You have not placed any orders yet" %}</p>
              {% endfor %}
            </ul>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
